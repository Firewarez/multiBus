generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Stop {
  id            Int         @id @default(autoincrement())
  name          String      @db.VarChar(100)
  latitude      Decimal     @db.Decimal(9, 6)
  longitude     Decimal     @db.Decimal(9, 6)
  traffic_level String?     @db.VarChar(20)
  routes        RouteStop[]

  @@map("stops")
}

model Line {
  id          Int     @id @default(autoincrement())
  code        String  @db.VarChar(20)
  name        String  @db.VarChar(100)
  description String? @db.VarChar(255)
  status      String? @db.VarChar(50)
  color       String? @db.VarChar(20)
  routes      Route[]

  @@map("lines")
}

model Route {
  id        Int         @id @default(autoincrement())
  lineId    Int         @map("line_id")
  direction String      @db.VarChar(10)
  stops     RouteStop[]
  line      Line        @relation(fields: [lineId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("routes")
}

model RouteStop {
  id         Int   @id @default(autoincrement())
  routeId    Int   @map("route_id")
  stopId     Int   @map("stop_id")
  stop_order Int
  route      Route @relation(fields: [routeId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  stop       Stop  @relation(fields: [stopId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([routeId], map: "idx_route_stops_route")
  @@index([stopId], map: "idx_route_stops_stop")
  @@map("route_stops")
}

model login {
  id         Int       @id @default(autoincrement())
  usuario_id Int
  senha      String    @db.VarChar(255)
  data_login DateTime? @default(now()) @db.Timestamp(6)
  usuario    usuario   @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model paradafav {
  id         Int     @id @default(autoincrement())
  usuario_id Int
  name       String  @db.VarChar(100)
  longitude  Decimal @db.Decimal(9, 6)
  latitude   Decimal @db.Decimal(9, 6)
  usuario    usuario @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model recarga_cartao {
  id                     Int      @id @default(autoincrement())
  usuario_id             Int?
  numero_cartao          String   @db.VarChar(20)
  cpf                    String   @db.VarChar(14)
  nome_titular           String   @db.VarChar(100)
  valor_recarga          Decimal  @db.Decimal(10, 2)
  status                 String?  @default("pendente") @db.VarChar(20)
  metodo_pagamento       String   @db.VarChar(50)
  ultimos_digitos_cartao String?  @db.VarChar(4)
  transacao_id           String?  @db.VarChar(100)
  usuario                usuario? @relation(fields: [usuario_id], references: [id], onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model saldo_cartao {
  id            Int      @id @default(autoincrement())
  numero_cartao String   @unique @db.VarChar(20)
  cpf_titular   String   @db.VarChar(14)
  saldo_atual   Decimal? @default(0.00) @db.Decimal(10, 2)
  ativo         Boolean? @default(true)
}

model usuario {
  id             Int              @id @default(autoincrement())
  nome           String           @db.VarChar(100)
  email          String           @unique @db.VarChar(100)
  cpf            String           @unique @db.VarChar(14)
  telefone       String?          @db.VarChar(15)
  nascimento     DateTime         @db.Date
  senha          String           @db.VarChar(255)
  login          login[]
  paradafav      paradafav[]
  recarga_cartao recarga_cartao[]
}

model Notification {
  id             Int       @id @default(autoincrement())
  type           String    @db.VarChar(20)
  title          String    @db.VarChar(200)
  description    String?   @db.Text
  createdAt      DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt      DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  isActive       Boolean   @default(true) @map("is_active")
  priority       String    @default("media") @db.VarChar(10)
  startDate      DateTime? @map("start_date") @db.Timestamp(6)
  endDate        DateTime? @map("end_date") @db.Timestamp(6)
  affectedLines  String?   @map("affected_lines") @db.VarChar(100)
  affectedStops  String?   @map("affected_stops") @db.VarChar(100)

  @@map("notifications")
}
